"use client";

import React, { useMemo } from "react";
import { motion, useReducedMotion, type Variants } from "framer-motion";

type Kind = "teal" | "dark";
type PathDef = { d: string; kind: Kind };

const PATHS: readonly PathDef[] = [
  // TEAL
  {
    d: "M284.022 126.593C284.012 124.878 283.863 123.17 283.594 121.477C282.59 115.169 285.807 112.42 288.667 118.131C288.773 118.344 288.87 118.493 289.012 118.683C291.046 121.421 295.177 120.44 295.227 117.03C295.542 95.8543 279.998 79.2107 270.235 73.5607C269.384 73.0684 268.446 72.7289 267.518 72.406C255.498 68.2249 238.705 71.6422 240.031 84.2998C242.741 110.167 262.197 124.829 277.312 130.905C280.542 132.203 284.043 130.074 284.022 126.593Z",
    kind: "teal",
  },
  {
    d: "M326.706 61.9308C327.238 59.7846 327.296 57.0785 327.098 54.3038C326.953 52.2745 317.678 49.5368 316.1 50.8202C315.938 50.9512 315.775 51.034 315.581 51.1059C311.28 52.6927 305.592 57.7353 303.24 60.1093C299.553 64.4497 297.696 68.9439 296.919 73.0027C296.189 76.8155 301.886 73.8313 304.153 70.6794C306.588 67.2924 307.016 72.5271 305.576 76.4422C305.033 77.9179 304.603 79.321 304.267 80.6204C303.418 83.9068 306.593 86.3075 309.569 84.6757C320.961 78.4301 325.159 68.1742 326.706 61.9308Z",
    kind: "teal",
  },
  {
    d: "M333.472 130.536C346.021 121.068 349.891 105.085 350.001 91.1757C350.04 86.3317 340.315 82.6841 336.233 85.2918C335.908 85.499 335.547 85.6703 335.185 85.8002C329.506 87.8357 317.447 93.954 310.46 103.825C308.32 106.848 319.889 111.06 322.684 108.628C326.786 105.058 330.848 102.123 333.926 100.182C327.721 104.565 323.071 110.674 319.691 116.891C314.151 127.078 324.216 137.52 333.472 130.536Z",
    kind: "teal",
  },
  {
    d: "M294.193 123.815C294.226 123.848 294.255 123.883 294.281 123.922C305.294 140.427 306.878 168.526 306.878 189.438C306.878 204.01 302.61 221.568 296.042 239.9C289.474 258.231 278.615 275.083 264.198 289.32C249.78 303.558 232.139 314.85 212.462 322.437C192.784 330.024 171.528 333.728 150.125 333.302C128.723 332.875 107.67 328.327 88.3854 319.963C69.1011 311.6 52.0329 299.615 38.3306 284.817C24.6284 270.019 14.6103 252.751 8.95117 234.176C13.706 249.783 46.969 280.512 52.3594 284.817C66.8002 296.351 77.6738 300.807 93.8767 307.834C110.08 314.861 132.143 316.583 150.125 316.941C168.108 317.3 188.701 314.208 205.234 307.834C221.767 301.46 236.424 289.409 248.538 277.447C260.652 265.484 268.971 253.19 277.997 236.796C285.217 222.224 288.833 205.831 292.437 189.438C295.559 175.243 297.527 142.764 291.974 125.308C291.706 124.465 293.571 123.187 294.193 123.815Z",
    kind: "teal",
  },

  // DARK
  {
    d: "M84.8465 129.325C79.4312 131.147 77.6261 131.147 66.7955 143.897C58.1311 154.097 49.9479 189.434 46.9395 205.827L48.7445 185.791L52.3547 163.933C54.1598 153.004 60.2972 134.061 84.8465 123.861C115.533 111.11 115.533 101.041 115.533 92.8955C115.533 83.7881 111.923 63.7518 108.313 52.8229C106.508 44.3227 104.703 25.1364 111.923 16.3933C120.948 5.46446 129.974 0 144.415 0C158.855 0 167.881 7.28592 175.101 18.2148C180.878 26.9579 182.322 44.9299 182.322 52.8229C181.72 59.5017 179.795 73.5878 176.906 76.5022C176.36 77.0531 175.763 77.4826 175.141 77.8126C173.918 78.4607 174.071 77.4871 175.071 76.5317C175.129 76.4762 175.123 76.4693 175.167 76.4021C180.479 68.2328 180.011 53.2199 178.953 45.3347C178.807 44.2525 178.723 43.1716 178.674 42.0808C178.09 29.18 170.666 8.95603 151.635 5.46445C136.835 2.74917 125.065 10.3639 120.12 15.3452C119.446 16.0237 118.765 16.6938 118.098 17.3784C109.2 26.5056 111.408 44.6291 113.728 52.823C117.338 61.9304 122.754 83.7881 120.948 100.181C119.143 116.575 90.2618 127.504 84.8465 129.325Z",
    kind: "dark",
  },
  {
    d: "M99.2678 240.435C99.2678 215.656 92.3325 197.875 90.4863 192.693C89.3638 193.167 85.8838 191.95 86.6475 189.381L88.2172 184.102C89.4187 180.06 94.7726 180.032 95.6934 184.147C100.604 206.09 100.269 229.823 99.2678 240.435Z",
    kind: "dark",
  },
  {
    d: "M192.381 204.427C193.567 194.749 195.539 185.267 197.524 177.516C198.642 173.153 203.824 172.291 205.774 176.351C207.785 180.54 209.559 185.331 211.072 190.146C212.288 194.015 207.904 195.564 206.104 191.931C204.685 189.069 200.628 189.448 199.952 192.57C199.152 196.264 198.47 200.148 197.892 204.078C196.596 212.883 191.299 213.261 192.381 204.427Z",
    kind: "dark",
  },
  {
    d: "M120.929 149.361C119.124 160.29 120.929 174.861 138.98 213.112C141.841 219.176 147.235 220.349 145.051 214.009C144.238 211.648 143.4 209.504 142.59 207.648C130.469 184.35 125.826 165.902 125.389 151.723C125.115 142.816 122.381 140.569 120.929 149.361Z",
    kind: "dark",
  },
  {
    d: "M200.353 125.681C204.313 126.151 207.95 127.354 211.278 129.105C217.121 132.179 223.882 129.367 218.404 125.681C215.997 123.86 204.685 118.395 193.133 118.395C181.58 118.395 173.878 115.36 169.667 112.931C167.519 111.968 165.834 110.693 164.535 109.2C162.396 106.742 159.619 106.194 160.641 109.288C162.446 114.752 175.804 122.767 200.353 125.681Z",
    kind: "dark",
  },
  {
    d: "M245.493 255.042C232.845 269.177 215.62 281.719 198.561 289.65C181.501 297.58 161.021 300.085 142.285 300.539C123.549 300.993 104.917 297.569 87.5093 290.473C70.1014 283.377 54.2771 272.756 40.9879 259.249C27.6987 245.742 17.2191 229.626 10.1792 211.873C3.13928 194.119 -0.315478 175.093 0.0226224 155.94C0.360723 136.786 4.4847 117.901 12.1466 100.418C19.8085 82.9356 33.1752 67.6873 46.9325 54.6787C34.6211 66.3201 23.4663 87.4255 18.051 103.819C12.6357 120.212 12.9382 138.8 12.6357 155.94C12.3331 173.08 17.4174 190.376 23.7174 206.264C30.6866 220.434 40.4553 235.668 52.3478 247.756C64.2403 259.844 75.8141 269.347 92.9202 276.603C106.501 282.364 124.047 288.801 140.798 289.65C157.043 290.473 171.484 289.65 187.73 286.007C203.976 282.364 234.174 267.692 245.493 255.042Z",
    kind: "dark",
  },
] as const;

const EASE: [number, number, number, number] = [0.22, 1, 0.36, 1];

const makeOpacityVariants = (baseDelay: number, reduce: boolean): Variants => ({
  hidden: { opacity: 0 },
  show: (i: number) => ({
    opacity: 1,
    transition: reduce
      ? { duration: 0.08, ease: "linear", delay: i * 0.01 }
      : { duration: 0.18, ease: EASE, delay: baseDelay + i * 0.045 },
  }),
});

function isSafariUA() {
  if (typeof navigator === "undefined") return false;
  const ua = navigator.userAgent;
  const vendor = navigator.vendor || "";
  const isApple = vendor.includes("Apple");
  const isCriOS = ua.includes("CriOS");
  const isFxiOS = ua.includes("FxiOS");
  return isApple && !isCriOS && !isFxiOS;
}

export default function Preload() {
  const reduce = useReducedMotion();
  const safari = useMemo(() => isSafariUA(), []);

  const { teal, dark } = useMemo(() => {
    return {
      teal: PATHS.filter((p) => p.kind === "teal"),
      dark: PATHS.filter((p) => p.kind === "dark"),
    };
  }, []);

  const tealVariants = useMemo(() => makeOpacityVariants(0.0, !!reduce), [reduce]);
  const darkVariants = useMemo(() => makeOpacityVariants(reduce ? 0.02 : 0.38, !!reduce), [reduce]);

  const floatA = reduce ? {} : { y: [0, -4, 0] };
  const floatAT = reduce ? undefined : { duration: 2.6, ease: "easeInOut", repeat: Infinity };

  const floatB = reduce ? {} : safari ? { y: [0, -2, 0] } : { y: [0, -2, 0] };
  const floatBT = reduce ? undefined : { duration: 3.1, ease: "easeInOut", repeat: Infinity, delay: 0.12 };

  return (
    <div className="flex flex-col items-center gap-6">
      <motion.svg
        width="350"
        height="334"
        viewBox="0 0 350 334"
        className="h-auto w-[200px] sm:w-[240px] md:w-[280px]"
        aria-hidden="true"
      >
        <motion.g animate={floatA} transition={floatAT} style={{ willChange: reduce ? undefined : "transform" }}>
          {teal.map((p, i) => (
            <motion.path
              key={`teal-${i}`}
              d={p.d}
              className="fill-teal-700"
              variants={tealVariants}
              initial="hidden"
              animate="show"
              custom={i}
            />
          ))}
        </motion.g>

        <motion.g animate={floatB} transition={floatBT} style={{ willChange: reduce ? undefined : "transform" }}>
          {dark.map((p, i) => (
            <motion.path
              key={`dark-${i}`}
              d={p.d}
              className="fill-teal-950"
              variants={darkVariants}
              initial="hidden"
              animate="show"
              custom={i}
            />
          ))}
        </motion.g>
      </motion.svg>
    </div>
  );
}
